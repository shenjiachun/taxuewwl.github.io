
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>用户授权之支付宝H5授权 | 朝·闻·道</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="SnoWalker">
    

    <meta name="keywords" content="auth">
    <meta name="description" content="本文主要总结支付宝H5方式获取用户授权信息。
请求地址静默授权的权限作用于较小为：auth_base

url拼接规则：
https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=APPID&amp;amp;auth_skip=false&amp;amp;scope=SCOPE&amp;amp;redirect_uri=ENCODED_URL">
<meta property="og:type" content="article">
<meta property="og:title" content="用户授权之支付宝H5授权">
<meta property="og:url" content="http://wuwenliang.net/2018/07/16/用户授权之支付宝H5授权/index.html">
<meta property="og:site_name" content="朝·闻·道">
<meta property="og:description" content="本文主要总结支付宝H5方式获取用户授权信息。
请求地址静默授权的权限作用于较小为：auth_base

url拼接规则：
https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=APPID&amp;amp;auth_skip=false&amp;amp;scope=SCOPE&amp;amp;redirect_uri=ENCODED_URL">
<meta property="og:image" content="http://wuwenliang.net/2018/07/16/用户授权之支付宝H5授权/zfbauth-user.png">
<meta property="og:updated_time" content="2018-07-16T13:50:59.399Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="用户授权之支付宝H5授权">
<meta name="twitter:description" content="本文主要总结支付宝H5方式获取用户授权信息。
请求地址静默授权的权限作用于较小为：auth_base

url拼接规则：
https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=APPID&amp;amp;auth_skip=false&amp;amp;scope=SCOPE&amp;amp;redirect_uri=ENCODED_URL">
<meta name="twitter:image" content="http://wuwenliang.net/2018/07/16/用户授权之支付宝H5授权/zfbauth-user.png">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="朝·闻·道" title="朝·闻·道"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="朝·闻·道">朝·闻·道</a></h1>
				<h2 class="blog-motto">SnoWalker&#39;s Blog</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/old/index.html">旧版</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:wuwenliang.net">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/07/16/用户授权之支付宝H5授权/" title="用户授权之支付宝H5授权" itemprop="url">用户授权之支付宝H5授权</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="SnoWalker" target="_blank" itemprop="author">SnoWalker</a>
		
  <p class="article-time">
    <time datetime="2018-07-16T13:42:43.000Z" itemprop="datePublished"> 发表于 2018-07-16</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#请求地址"><span class="toc-number">1.</span> <span class="toc-text">请求地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求参数"><span class="toc-number">2.</span> <span class="toc-text">请求参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取auth-code"><span class="toc-number">3.</span> <span class="toc-text">获取auth_code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#auth-code换取access-token与user-id"><span class="toc-number">4.</span> <span class="toc-text">auth_code换取access_token与user_id</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#授权接入注意事项【必读】"><span class="toc-number">4.1.</span> <span class="toc-text">授权接入注意事项【必读】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#说明："><span class="toc-number">4.1.1.</span> <span class="toc-text">说明：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scope有效期："><span class="toc-number">4.1.2.</span> <span class="toc-text">scope有效期：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#建议："><span class="toc-number">4.1.3.</span> <span class="toc-text">建议：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#授权作用域"><span class="toc-number">4.2.</span> <span class="toc-text">授权作用域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文档地址"><span class="toc-number">5.</span> <span class="toc-text">文档地址</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#支付宝显式授权"><span class="toc-number"></span> <span class="toc-text">支付宝显式授权</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#授权流程"><span class="toc-number">1.</span> <span class="toc-text">授权流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#具体步骤"><span class="toc-number">2.</span> <span class="toc-text">具体步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-URL拼接"><span class="toc-number">2.1.</span> <span class="toc-text">1.URL拼接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#url参数说明"><span class="toc-number">2.1.1.</span> <span class="toc-text">url参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-获取auth-code"><span class="toc-number">2.2.</span> <span class="toc-text">2. 获取auth_code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-使用auth-code换取接口access-token及用户userId"><span class="toc-number">2.3.</span> <span class="toc-text">3.使用auth_code换取接口access_token及用户userId</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#请求发送实例"><span class="toc-number">2.3.1.</span> <span class="toc-text">请求发送实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#同步响应参数说明"><span class="toc-number">2.3.2.</span> <span class="toc-text">同步响应参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-调用接口获取用户信息"><span class="toc-number">2.4.</span> <span class="toc-text">4.调用接口获取用户信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#接口调用示例"><span class="toc-number">2.4.1.</span> <span class="toc-text">接口调用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#同步响应结果示例"><span class="toc-number">2.4.2.</span> <span class="toc-text">同步响应结果示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#接口调用结果码说明"><span class="toc-number">2.4.3.</span> <span class="toc-text">接口调用结果码说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意"><span class="toc-number">2.5.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文档地址-1"><span class="toc-number">3.</span> <span class="toc-text">文档地址</span></a></li></ol>
		
		</div>
		
		<p>本文主要总结支付宝H5方式获取用户授权信息。</p>
<h2 id="请求地址"><a href="#请求地址" class="headerlink" title="请求地址"></a>请求地址</h2><p>静默授权的权限作用于较小为：<strong>auth_base</strong></p>
<blockquote>
<p>url拼接规则：</p>
<p><a href="https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=APPID&amp;auth_skip=false&amp;scope=SCOPE&amp;redirect_uri=ENCODED_URL" target="_blank" rel="external">https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=APPID&amp;auth_skip=false&amp;scope=SCOPE&amp;redirect_uri=ENCODED_URL</a><br><a id="more"></a><br>url参数说明</p>
<table><br><thead><br><tr><br><th style="text-align:left;">参数名</th><br><th style="text-align:left;">是否必须</th><br><th style="text-align:left;">长度</th><br><th style="text-align:left;">描述</th><br></tr><br></thead><br><tbody><br><tr><br><td style="text-align:left;">app_id</td><br><td style="text-align:left;">是</td><br><td style="text-align:left;">16</td><br><td style="text-align:left;">开发者应用的app_id； 相同支付宝账号下，不同的app_id获取的token切忌混用。</td><br></tr><br><tr><br><td style="text-align:left;">scope</td><br><td style="text-align:left;">是</td><br><td style="text-align:left;">不定，取决于请求授权时scope个数</td><br><td style="text-align:left;">接口权限值，目前只支持auth_user（<a href="284/106000">获取用户信息</a>、<a href="263/105808">网站支付宝登录</a>）、auth_base（用户信息授权）、auth_ecard（<a href="251/105663">商户会员卡</a>）、auth_invoice_info（<a href="396/106894">支付宝闪电开票</a>）、auth_puc_charge（<a href="217/105324">生活缴费</a>）五个值;多个scope时用”,”分隔，如scope为”auth_user,auth_ecard”时，此时获取到的access_token，既可以用来获取用户信息，又可以给用户发送会员卡。</td><br></tr><br><tr><br><td style="text-align:left;">redirect_uri</td><br><td style="text-align:left;">是</td><br><td style="text-align:left;">100</td><br><td style="text-align:left;">授权回调地址，是经过URLENCODE转义 的url链接（url必须以http或者https开头）； 在请求之前，开发者需要先到开发者中心对应应用内，<a href="#s0">配置授权回调地址</a>。 redirect_uri与应用配置的授权回调地址域名部分必须一致。</td><br></tr><br><tr><br><td style="text-align:left;">state</td><br><td style="text-align:left;">否</td><br><td style="text-align:left;">100</td><br><td style="text-align:left;">商户自定义参数，用户授权后，重定向到redirect_uri时会原样回传给商户。 为防止CSRF攻击，建议开发者请求授权时传入state参数，该参数要做到既不可预测，又可以证明客户端和当前第三方网站的登录认证状态存在关联。</td><br></tr><br></tbody><br></table>

</blockquote>
<h2 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h2><p>在SDK调用前需要进行初始化，以Java代码为示例如下：</p>
<pre><code>AlipayClient alipayClient = new DefaultAlipayClient(URL, APP_ID,
 APP_PRIVATE_KEY, FORMAT, CHARSET, ALIPAY_PUBLIC_KEY, SIGN_TYPE);
</code></pre><p>关键参数说明:</p>
<table><br><thead><br><tr><br><th style="text-align:left;">配置参数</th><br><th style="text-align:left;">示例值解释</th><br><th style="text-align:left;">获取方式/示例值</th><br></tr><br></thead><br><tbody><br><tr><br><td style="text-align:left;">URL</td><br><td style="text-align:left;">支付宝网关（固定）</td><br><td style="text-align:left;"><a href="https://openapi.alipay.com/gateway.do" target="_blank" rel="noopener">https://openapi.alipay.com/gateway.do</a></td><br></tr><br><tr><br><td style="text-align:left;">APPID</td><br><td style="text-align:left;">APPID 即创建应用后生成</td><br><td style="text-align:left;">获取见上面<a href="#s0">应用设置</a></td><br></tr><br><tr><br><td style="text-align:left;">APP_PRIVATE_KEY</td><br><td style="text-align:left;">开发者私钥，由开发者自己生成</td><br><td style="text-align:left;">获取详见上面<a href="#s0">应用设置</a></td><br></tr><br><tr><br><td style="text-align:left;">FORMAT</td><br><td style="text-align:left;">参数返回格式，只支持json</td><br><td style="text-align:left;">json（固定）</td><br></tr><br><tr><br><td style="text-align:left;">CHARSET</td><br><td style="text-align:left;">编码集，支持GBK/UTF-8</td><br><td style="text-align:left;">开发者根据实际工程编码配置</td><br></tr><br><tr><br><td style="text-align:left;">ALIPAY_PUBLIC_KEY</td><br><td style="text-align:left;">支付宝公钥，由支付宝生成</td><br><td style="text-align:left;">获取详见上面<a href="#s0">应用设置</a></td><br></tr><br><tr><br><td style="text-align:left;">SIGN_TYPE</td><br><td style="text-align:left;">商户生成签名字符串所使用的签名算法类型，目前支持RSA2和RSA，推荐使用RSA2</td><br><td style="text-align:left;">RSA2</td><br></tr><br></tbody><br></table>

<h2 id="获取auth-code"><a href="#获取auth-code" class="headerlink" title="获取auth_code"></a>获取auth_code</h2><p>当用户授权成功后，会跳转至开发者定义的回调页面，支付宝会在回调页面请求中加入参数，包括auth_code、app_id、scope等，支付宝请求开发者回调页面示例如下：</p>
<pre><code>http或https打头的授权回调地址? app_id=2016032301002387 &amp;scope=auth_user&amp;
auth_code=10e20498fe5d42f18427d893fc06WX59  
</code></pre><p>关键返回参数说明：</p>
<table><br><thead><br><tr><br><th style="text-align:left;">参数名</th><br><th style="text-align:left;">是否必须</th><br><th style="text-align:left;">长度</th><br><th style="text-align:left;">描述</th><br></tr><br></thead><br><tbody><br><tr><br><td style="text-align:left;">app_id</td><br><td style="text-align:left;">是</td><br><td style="text-align:left;">16</td><br><td style="text-align:left;">开发者应用的app_id；相同支付宝账号下，不同的app_id获取的token切忌混用。</td><br></tr><br><tr><br><td style="text-align:left;">scope</td><br><td style="text-align:left;">是</td><br><td style="text-align:left;">不定，取决于请求授权时scope个数</td><br><td style="text-align:left;">成功授权的接口权限值，目前只支持auth_user（<a href="https://docs.open.alipay.com/284/106000" target="_blank" rel="noopener">获取用户信息</a>、<a href="https://docs.open.alipay.com/263/105808" target="_blank" rel="noopener">网站支付宝登录</a>）、auth_base（用户信息授权）、auth_ecard（<a href="https://docs.open.alipay.com/251/105663" target="_blank" rel="noopener">商户会员卡</a>）、auth_invoice_info（<a href="https://docs.open.alipay.com/396/106894" target="_blank" rel="noopener">支付宝闪电开票</a>）、auth_puc_charge（<a href="https://docs.open.alipay.com/217/105324" target="_blank" rel="noopener">生活缴费</a>）五个值;多个scope时用“,”分隔，如scope为“auth_user,auth_ecard”时，此时获取到的access_token，既可以用来获取用户信息，又可以给用户发送会员卡</td><br></tr><br><tr><br><td style="text-align:left;">error_scope</td><br><td style="text-align:left;">否</td><br><td style="text-align:left;">不定，少于请求授权时scope个数</td><br><td style="text-align:left;">error_scope表示授权是失败的scope列表及对应的错误信息（错误列表之间用“</td><br></tr><br><tr><br><td style="text-align:left;">state</td><br><td style="text-align:left;">否</td><br><td style="text-align:left;">100</td><br><td style="text-align:left;">商户自定义参数，用户授权后，重定向到redirect_uri时会原样回传给商户。 为防止CSRF攻击，建议开发者请求授权时传入state参数，该参数要做到既不可预测，又可以证明客户端和当前第三方网站的登录认证状态存在关联。</td><br></tr><br><tr><br><td style="text-align:left;">auth_code</td><br><td style="text-align:left;">是</td><br><td style="text-align:left;">目前为32，后期会根据安全策略适当调整，请勿限制该字段长度。</td><br><td style="text-align:left;">临时授权码，一次性有效，同时若超过有效期未使用，则会失效。有效期目前至少为5分钟，最长为24小时。请获取auth_code后尽快通过调用alipay.system.oauth.token接口获取访问令牌</td><br></tr><br></tbody><br></table>

<p>注意：其余返回字段无需关注。</p>
<h2 id="auth-code换取access-token与user-id"><a href="#auth-code换取access-token与user-id" class="headerlink" title="auth_code换取access_token与user_id"></a>auth_code换取access_token与user_id</h2><p>通过接口 alipay.system.oauth.token 获取access_token及userId。</p>
<pre><code>AlipayClient alipayClient = new DefaultAlipayClient(&quot;https://openapi.alipay.com/gateway.do&quot;, 
APP_ID, 
APP_PRIVATE_KEY, 
&quot;json&quot;, 
CHARSET, 
ALIPAY_PUBLIC_KEY, 
&quot;RSA2&quot;); 
AlipaySystemOauthTokenRequest request = new AlipaySystemOauthTokenRequest();
request.setCode(&quot;2e4248c2f50b4653bf18ecee3466UC18&quot;);
request.setGrantType(&quot;authorization_code&quot;);
try {
    AlipaySystemOauthTokenResponse oauthTokenResponse = alipayClient.execute(request);
    System.out.println(oauthTokenResponse.getAccessToken());
} catch (AlipayApiException e) {
    //处理异常
    e.printStackTrace();
}
</code></pre><p>至此，用户信息授权流程已结束，如果只想拿到user_id（支付宝用户唯一标识符），则无需看下一步。</p>
<h3 id="授权接入注意事项【必读】"><a href="#授权接入注意事项【必读】" class="headerlink" title="授权接入注意事项【必读】"></a>授权接入注意事项【必读】</h3><p>授权scope</p>
<h4 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h4><p>scope为公开的资源，其使用不需要签约。</p>
<p>开发者可以在授权请求中包含一个或者多个用户授权范围，每个授权范围称为一个scope，一个scope包含若干个开放平台接口，请求的多个scope通过英文逗号分隔。<br>授权的流程是通用的，在不同的业务场景需要授权的范围不同，需要根据具体产品接入文档中指定的scope替换本文中的scope参数。</p>
<h4 id="scope有效期："><a href="#scope有效期：" class="headerlink" title="scope有效期："></a>scope有效期：</h4><p>这里的scope有效期和前面的auth_code有效期是两个概念。</p>
<p>scope的有效期会影响开发者最终获取到的access_token和refresh_token的有效期，不同scope的有效期请参考具体的产品文档。</p>
<h4 id="建议："><a href="#建议：" class="headerlink" title="建议："></a>建议：</h4><p>为了产品体验考虑请按需请求需要的scope，过多的授权范围容易导致用户放弃授权。建议在做产品的登录场景中使用auth_base或者auth_user做用户引流，后续根据需要具体业务需要引导用户请求特定scope的用户授权。</p>
<h3 id="授权作用域"><a href="#授权作用域" class="headerlink" title="授权作用域"></a>授权作用域</h3><p>成功授权的接口权限值，目前只支持</p>
<pre><code>auth_user（获取用户信息、网站支付宝登录）、
auth_base（用户信息授权）、
auth_ecard（商户会员卡）、
auth_invoice_info（支付宝闪电开票）、
auth_puc_charge（生活缴费）五个值;
</code></pre><p>多个scope时用“,”分隔，如scope为“auth_user,auth_ecard”时，此时获取到的access_token，既可以用来获取用户信息，又可以给用户发送会员卡</p>
<h2 id="文档地址"><a href="#文档地址" class="headerlink" title="文档地址"></a>文档地址</h2><p><a href="https://docs.open.alipay.com/289/105656/" target="_blank" rel="external">https://docs.open.alipay.com/289/105656/</a></p>
<hr>
<h1 id="支付宝显式授权"><a href="#支付宝显式授权" class="headerlink" title="支付宝显式授权"></a>支付宝显式授权</h1><blockquote>
<p>用户需要完成对商户应用的授权，商户获取token后即可调用接口获取用户信息。</p>
</blockquote>
<h2 id="授权流程"><a href="#授权流程" class="headerlink" title="授权流程"></a>授权流程</h2><p><img src="/2018/07/16/用户授权之支付宝H5授权/zfbauth-user.png" alt="授权流程"></p>
<p>如上图所示，对于开发者而言，需要完成以下工作：</p>
<ol>
<li>按照规则拼接授权页面的链接，并且引导用户跳转至该链接；</li>
<li>用户在授权页面上确认授权后，将跳转到开发者指定的回调页，并且带上auth_code；</li>
<li>开发者通过auth_code换取access_token及用户的userId；</li>
<li>如果需要除userId以外的其他信息，则使用access_token调用用户信息共享接口获取。</li>
</ol>
<h2 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h2><h3 id="1-URL拼接"><a href="#1-URL拼接" class="headerlink" title="1.URL拼接"></a>1.URL拼接</h3><p><a href="https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=APPID&amp;scope=SCOPE&amp;redirect_uri=ENCODED_URL" target="_blank" rel="external">https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=APPID&amp;scope=SCOPE&amp;redirect_uri=ENCODED_URL</a></p>
<p><strong>这里因为我们要获取用户信息，因此scope要使用<font color="red">auth_user</font></strong></p>
<blockquote>
<p>使用场景举例：开发者通过URL拼接方案，构造授权页面，并且引导用户授权。</p>
</blockquote>
<h4 id="url参数说明"><a href="#url参数说明" class="headerlink" title="url参数说明"></a>url参数说明</h4><table><br><thead><br><tr><br><th><strong>参数名</strong></th><br><th><strong>是否必须</strong></th><br><th><strong>描述</strong></th><br></tr><br></thead><br><tbody><br><tr><br><td>app_id</td><br><td>是</td><br><td>开发者应用的app_id</td><br></tr><br><tr><br><td>scope</td><br><td>是</td><br><td>接口权限值，目前只支持auth_user和auth_base两个值</td><br></tr><br><tr><br><td>redirect_uri</td><br><td>是</td><br><td>回调页面，是 经过转义 的url链接（url必须以http或者https开头），比如：http%3A%2F%2Fexample.com<br>在请求之前，开发者需要先到开发者中心对应应用内，配置授权回调地址。</td><br></tr><br><tr><br><td>state</td><br><td>否</td><br><td>商户自定义参数，用户授权后，重定向到redirect_uri时会原样回传给商户。 为防止CSRF攻击，建议开发者请求授权时传入state参数，该参数要做到既不可预测，又可以证明客户端和当前第三方网站的登录认证状态存在关联。</td><br></tr><br></tbody><br></table>

<h3 id="2-获取auth-code"><a href="#2-获取auth-code" class="headerlink" title="2. 获取auth_code"></a>2. 获取auth_code</h3><p>具体步骤捅静默授权</p>
<p>当用户授权成功后，会跳转至开发者定义的回调页面，支付宝会在回调页面请求中加入参数，包括auth_code、app_id、scope等，需要注意的是支付宝仅保证auth_code、app_id以及scope参数的有效性。支付宝请求开发者回调页面示例如下：</p>
<pre><code>http://example.com/doc/toAuthPage.html?app_id=2014101500013658&amp;
source=alipay_wallet&amp;scope=auth_user&amp;
auth_code=ca34ea491e7146cc87d25fca24c4cD11
</code></pre><h3 id="3-使用auth-code换取接口access-token及用户userId"><a href="#3-使用auth-code换取接口access-token及用户userId" class="headerlink" title="3.使用auth_code换取接口access_token及用户userId"></a>3.使用auth_code换取接口access_token及用户userId</h3><p>接口名称：alipay.system.oauth.token</p>
<blockquote>
<p>换取授权访问令牌，开发者可通过获取到的auth_code换取access_token和用户userId。auth_code作为换取access_token的票据，每次用户授权完成，回调地址中的auth_code将不一样，auth_code只能使用一次，一天未被使用自动过期。</p>
<h4 id="请求发送实例"><a href="#请求发送实例" class="headerlink" title="请求发送实例"></a>请求发送实例</h4></blockquote>
<pre><code>AlipayClient alipayClient = new DefaultAlipayClient(&quot;https://openapi.alipay.com/gateway.do&quot;, APP_ID, APP_PRIVATE_KEY, &quot;json&quot;, CHARSET, ALIPAY_PUBLIC_KEY, &quot;RSA2&quot;); 
AlipaySystemOauthTokenRequest request = new AlipaySystemOauthTokenRequest();
request.setCode(&quot;2e4248c2f50b4653bf18ecee3466UC18&quot;);
request.setGrantType(&quot;authorization_code&quot;);
try {
    AlipaySystemOauthTokenResponse oauthTokenResponse = alipayClient.execute(request);
    System.out.println(oauthTokenResponse.getAccessToken());
} catch (AlipayApiException e) {
    //处理异常
    e.printStackTrace();
}
</code></pre><p>请求参数说明</p>
<table><br><thead><br><tr><br><th><strong>参数</strong></th><br><th><strong>参数名称</strong></th><br><th><strong>类型（长度范围）</strong></th><br><th><strong>参数说明</strong></th><br><th><strong>是否可为空</strong></th><br><th><strong>样例</strong></th><br></tr><br></thead><br><tbody><br><tr><br><td>grant_type</td><br><td>授权类型</td><br><td>String</td><br><td>值为authorization_code时，代表用code换取；值为refresh_token时，代表用refresh_token换取</td><br><td>不可空</td><br><td>authorization_code</td><br></tr><br><tr><br><td>code</td><br><td>授权码</td><br><td>String</td><br><td>用户对应用授权后得到，即第二步中开发者获取到的auth_code值</td><br><td>与refresh_token二选一</td><br><td>4b203fe6c11548bcabd8da5bb087a83b</td><br></tr><br><tr><br><td>refresh_token</td><br><td>刷新令牌</td><br><td>String</td><br><td>刷新access_token时使用</td><br><td>与code二选一</td><br><td>201208134b203fe6c11548bcabd8da5bb087a83b</td><br></tr><br></tbody><br></table>

<p>返回报文</p>
<pre><code>{
    &quot;alipay_system_oauth_token_response&quot;: {
        &quot;access_token&quot;: &quot;publicpBa869cad0990e4e17a57ecf7c5469a4b2&quot;,
        &quot;user_id&quot;: &quot;2088411964574197&quot;,
        &quot;expires_in&quot;: 300,
        &quot;re_expires_in&quot;: 300,
        &quot;refresh_token&quot;: &quot;publicpB0ff17e364f0743c79b0b0d7f55e20bfc&quot;
    },
    &quot;sign&quot;: &quot;xDffQVBBelDiY/FdJi4/a2iQV1I7TgKDFf/9BUCe6+l1UB55YDOdlCAir8CGlTfa0zLYdX0UaYAa43zY2jLhCTDG+d6EjhCBWsNY74yTdiM95kTNsREgAt4PkOkpsbyZVXdLIShxLFAqI49GIv82J3YtzBcVDDdDeqFcUhfasII=&quot;
}
</code></pre><p>这一步拿到了userid</p>
<h4 id="同步响应参数说明"><a href="#同步响应参数说明" class="headerlink" title="同步响应参数说明"></a>同步响应参数说明</h4><table><br><thead><br><tr><br><th><strong>参数</strong></th><br><th><strong>参数名称</strong></th><br><th><strong>类型（长度范围）</strong></th><br><th><strong>参数说明</strong></th><br><th><strong>是否可为空</strong></th><br><th><strong>样例</strong></th><br></tr><br></thead><br><tbody><br><tr><br><td><br><p>access_token</p><br></td><br><td><br><p>交换令牌</p><br></td><br><td><br><p>String</p><br></td><br><td><br><p>用于获取用户信息</p><br></td><br><td><br><p>不可空</p><br></td><br><td><br><p>publicpBa869cad0990e4e17a57ecf7c5469a4b2</p><br></td><br></tr><br><tr><br><td><br><p>user_id</p><br></td><br><td><br><p>用户的userId</p><br></td><br><td><br><p>String</p><br></td><br><td><br><p>支付宝用户的唯一userId</p><br></td><br><td><br><p>不可空</p><br></td><br><td><br><p>2088411964574197</p><br></td><br></tr><br><tr><br><td><br><p>expires_in</p><br></td><br><td><br><p>令牌有效期</p><br></td><br><td><br><p>Number</p><br></td><br><td><br><p>交换令牌的有效期，单位秒</p><br></td><br><td><br><p>不可空</p><br></td><br><td><br><p>300</p><br></td><br></tr><br><tr><br><td><br><p>re_expires_in</p><br></td><br><td><br><p>刷新令牌有效期</p><br></td><br><td><br><p>Number</p><br></td><br><td><br><p>刷新令牌有效期，单位秒</p><br></td><br><td><br><p>不可空</p><br></td><br><td><br><p>300</p><br></td><br></tr><br><tr><br><td><br><p>refresh_token</p><br></td><br><td><br><p>刷新令牌</p><br></td><br><td><br><p>String</p><br></td><br><td><br><p>通过该令牌可以刷新access_token</p><br></td><br><td><br><p>不可空</p><br></td><br><td><br><p>publicpB0ff17e364f0743c79b0b0d7f55e20bfc</p><br></td><br></tr><br></tbody><br></table>

<h3 id="4-调用接口获取用户信息"><a href="#4-调用接口获取用户信息" class="headerlink" title="4.调用接口获取用户信息"></a>4.调用接口获取用户信息</h3><p>如果scope=auth_base，在第三步就可以获取到用户的userId，无需走第四步。如果scope=auth_user，才需要走第四步，通过access_token调用用户信息共享接口获取用户信息。</p>
<h4 id="接口调用示例"><a href="#接口调用示例" class="headerlink" title="接口调用示例"></a>接口调用示例</h4><pre><code>AlipayClient alipayClient = new DefaultAlipayClient(&quot;https://openapi.alipay.com/gateway.do&quot;, APP_ID, APP_PRIVATE_KEY, &quot;json&quot;, CHARSET, ALIPAY_PUBLIC_KEY, &quot;RSA2&quot;); 
AlipayUserInfoShareRequest request = new AlipayUserInfoShareRequest();
String auth_token = &quot;composeBcd261a4867d94837a701f92816f18X18&quot;;
try {
    AlipayUserInfoShareResponse userinfoShareResponse = alipayClient.execute(request, auth_token);
    System.out.println(userinfoShareResponse.getBody());
} catch (AlipayApiException e) {
    //处理异常
    e.printStackTrace();
}
</code></pre><p>公共请求参数说明</p>
<table><br><thead><br><tr><br><th>参数</th><br><th>参数名称</th><br><th>类型（长度范围）</th><br><th>参数说明</th><br><th>是否可为空</th><br><th>样例</th><br></tr><br></thead><br><tbody><br><tr><br><td><br><p>auth_token</p><br></td><br><td><br><p>授权令牌</p><br></td><br><td><br><p>String</p><br></td><br><td><br><p>通过auth_code获取的access_token</p><br></td><br><td><br><p>不可空</p><br></td><br><td><br><p>publicpB9ea460ff5b5c468c9ccf5e967dc34963</p><br></td><br></tr><br></tbody><br></table>

<h4 id="同步响应结果示例"><a href="#同步响应结果示例" class="headerlink" title="同步响应结果示例"></a>同步响应结果示例</h4><pre><code>{
    &quot;alipay_user_info_share_response&quot;: {
        &quot;code&quot;: &quot;10000&quot;,
        &quot;msg&quot;: &quot;Success&quot;,
        &quot;user_id&quot;: &quot;2088102104794936&quot;,
        &quot;avatar&quot;: &quot;http://tfsimg.alipay.com/images/partner/T1uIxXXbpXXXXXXXX&quot;,
        &quot;user_type&quot;: &quot;1&quot;,
        &quot;user_status&quot;: &quot;T&quot;,
        &quot;is_certified&quot;: &quot;T&quot;,
        &quot;province&quot;: &quot;安徽省&quot;,
        &quot;city&quot;: &quot;安庆&quot;,
        &quot;nick_name&quot;: &quot;支付宝小二&quot;,
        &quot;is_student_certified&quot;: &quot;T&quot;,
        &quot;gender&quot;: &quot;F&quot;
    },
    &quot;sign&quot;: &quot;ERITJKEIJKJHKKKKKKKHJEREEEEEEEEEEE&quot;
}
</code></pre><p>同步响应参数说明</p>
<table><br><thead><br><tr><br><th>参数</th><br><th>参数名称</th><br><th>类型（长度范围）</th><br><th>参数说明</th><br><th>是否可为空</th><br><th>样例</th><br></tr><br></thead><br><tbody><br><tr><br><td><br><p>user_id</p><br></td><br><td>支付宝用户id</td><br><td>String</td><br><td><strong>支付宝用户的Use_id</strong></td><br><td>必填</td><br><td>2088102104794936</td><br></tr><br><tr><br><td><br><p>avatar</p><br></td><br><td>用户头像</td><br><td>String</td><br><td><strong>如果没有数据的时候不会返回该数据，请做好容错</strong></td><br><td>必填</td><br><td><code><a href="https://tfsimg.alipay.com/images/partner/T1k0xiXXRnXXXXXXXX" target="_blank" rel="external">https://tfsimg.alipay.com/images/partner/T1k0xiXXRnXXXXXXXX</a></code></td><br></tr><br><tr><br><td><br><p>nick_name</p><br></td><br><td>用户昵称</td><br><td>String</td><br><td><strong>如果没有数据的时候不会返回该数据，请做好容错</strong></td><br><td>必填</td><br><td>张三</td><br></tr><br><tr><br><td><br><p>province</p><br></td><br><td>省份</td><br><td>String</td><br><td>用户注册时填写的省份&nbsp;<strong>如果没有数据的时候不会返回该数据，请做好容错</strong></td><br><td>必填</td><br><td>浙江省</td><br></tr><br><tr><br><td><br><p>city</p><br></td><br><td>城市</td><br><td>String</td><br><td>用户注册时填写的城市，&nbsp;<strong>如果没有数据的时候不会返回该数据，请做好容错</strong></td><br><td>必填</td><br><td>杭州</td><br></tr><br><tr><br><td><br><p>gender</p><br></td><br><td>用户性别</td><br><td>String</td><br><td>M为男性，F为女性，&nbsp;<strong>如果没有数据的时候不会返回该数据，请做好容错</strong></td><br><td>可空</td><br><td>M</td><br></tr><br><tr><br><td><br><p>user_type</p><br></td><br><td>用户类型&nbsp;</td><br><td>String</td><br><td>1代表公司账户2代表个人账户&nbsp;</td><br><td>可空&nbsp;</td><br><td>1&nbsp;</td><br></tr><br><tr><br><td><br><p>&nbsp;user_status</p><br></td><br><td>用户状态</td><br><td>String&nbsp;</td><br><td>Q代表快速注册用户 T代表已认证用户 B代表被冻结账户 W代表已注册，未激活的账户&nbsp;</td><br><td>可空&nbsp;</td><br><td>T&nbsp;</td><br></tr><br><tr><br><td><br><p>is_certified&nbsp;</p><br></td><br><td>是否通过实名认证</td><br><td>String&nbsp;</td><br><td>T是通过 F是没有实名认证&nbsp;</td><br><td>可空&nbsp;</td><br><td>T&nbsp;</td><br></tr><br><tr><br><td><br><p>&nbsp;is_student_certified</p><br></td><br><td>是否是学生</td><br><td>String&nbsp;</td><br><td>T是学生 F不是学生&nbsp;</td><br><td>可空&nbsp;</td><br><td>T&nbsp;</td><br></tr><br></tbody><br></table>

<h4 id="接口调用结果码说明"><a href="#接口调用结果码说明" class="headerlink" title="接口调用结果码说明"></a>接口调用结果码说明</h4><table style="margin:1px;padding:2px;" width="600"><br><thead><br><tr><br><th style="text-align:center;"><strong>同步返回结果码</strong></th><br><th style="text-align:center;"><strong>含义</strong></th><br><th style="text-align:center;"><strong>说明</strong></th><br></tr><br></thead><br><tbody><br><tr><br><td style="text-align:center;"><br><p>10000</p><br></td><br><td style="text-align:center;">业务处理成功</td><br><td>&nbsp;</td><br></tr><br><tr><br><td style="text-align:center;">40001～40006</td><br><td style="text-align:center;">业务处理失败</td><br><td>具体失败原因请参考<a href="common/105806" target="_blank">公共错误码</a>。其它请参考API文档。</td><br></tr><br><tr><br><td style="text-align:center;">20000</td><br><td style="text-align:center;">业务出现未知错误或者系统异常</td><br><td>业务出现未知错误或者系统异常(<span style="color:#ff0000;">请一定在确定本次调用结果后，发起重试</span>)，可调用查询接口发起查询确定结果。&nbsp;</td><br></tr><br></tbody><br></table>



<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>注：H5授权页只能在支付宝客户端里使用，否则会报错</p>
<h2 id="文档地址-1"><a href="#文档地址-1" class="headerlink" title="文档地址"></a>文档地址</h2><p><a href="https://docs.open.alipay.com/284/106000" target="_blank" rel="external">https://docs.open.alipay.com/284/106000</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/auth/">auth</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/auth/">auth</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://wuwenliang.net/2018/07/16/用户授权之支付宝H5授权/" data-title="用户授权之支付宝H5授权 | 朝·闻·道" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/07/22/JDK源码解析-3-Thread/" title="JDK源码解析[3]-Thread">
  <strong>上一篇：</strong><br/>
  <span>
  JDK源码解析[3]-Thread</span>
</a>
</div>


<div class="next">
<a href="/2018/07/16/用户授权之微信H5授权/"  title="用户授权之微信H5授权">
 <strong>下一篇：</strong><br/> 
 <span>用户授权之微信H5授权
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2018/07/16/用户授权之支付宝H5授权/" data-title="用户授权之支付宝H5授权" data-url="http://wuwenliang.net/2018/07/16/用户授权之支付宝H5授权/"></div>
</section>




</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#请求地址"><span class="toc-number">1.</span> <span class="toc-text">请求地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求参数"><span class="toc-number">2.</span> <span class="toc-text">请求参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取auth-code"><span class="toc-number">3.</span> <span class="toc-text">获取auth_code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#auth-code换取access-token与user-id"><span class="toc-number">4.</span> <span class="toc-text">auth_code换取access_token与user_id</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#授权接入注意事项【必读】"><span class="toc-number">4.1.</span> <span class="toc-text">授权接入注意事项【必读】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#说明："><span class="toc-number">4.1.1.</span> <span class="toc-text">说明：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scope有效期："><span class="toc-number">4.1.2.</span> <span class="toc-text">scope有效期：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#建议："><span class="toc-number">4.1.3.</span> <span class="toc-text">建议：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#授权作用域"><span class="toc-number">4.2.</span> <span class="toc-text">授权作用域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文档地址"><span class="toc-number">5.</span> <span class="toc-text">文档地址</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#支付宝显式授权"><span class="toc-number"></span> <span class="toc-text">支付宝显式授权</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#授权流程"><span class="toc-number">1.</span> <span class="toc-text">授权流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#具体步骤"><span class="toc-number">2.</span> <span class="toc-text">具体步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-URL拼接"><span class="toc-number">2.1.</span> <span class="toc-text">1.URL拼接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#url参数说明"><span class="toc-number">2.1.1.</span> <span class="toc-text">url参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-获取auth-code"><span class="toc-number">2.2.</span> <span class="toc-text">2. 获取auth_code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-使用auth-code换取接口access-token及用户userId"><span class="toc-number">2.3.</span> <span class="toc-text">3.使用auth_code换取接口access_token及用户userId</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#请求发送实例"><span class="toc-number">2.3.1.</span> <span class="toc-text">请求发送实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#同步响应参数说明"><span class="toc-number">2.3.2.</span> <span class="toc-text">同步响应参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-调用接口获取用户信息"><span class="toc-number">2.4.</span> <span class="toc-text">4.调用接口获取用户信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#接口调用示例"><span class="toc-number">2.4.1.</span> <span class="toc-text">接口调用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#同步响应结果示例"><span class="toc-number">2.4.2.</span> <span class="toc-text">同步响应结果示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#接口调用结果码说明"><span class="toc-number">2.4.3.</span> <span class="toc-text">接口调用结果码说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意"><span class="toc-number">2.5.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文档地址-1"><span class="toc-number">3.</span> <span class="toc-text">文档地址</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Dubbo/" title="Dubbo">Dubbo<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/ELK-Stack/" title="ELK-Stack">ELK-Stack<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/HTTPS/" title="HTTPS">HTTPS<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/JDK-concurrent/" title="JDK-concurrent">JDK-concurrent<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/JDK源码解析/" title="JDK源码解析">JDK源码解析<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>23</sup></a></li>
		  
		
		  
			<li><a href="/categories/KindEditor/" title="KindEditor">KindEditor<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Redis/" title="Redis">Redis<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/SSO/" title="SSO">SSO<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Sharding-JDBC/" title="Sharding-JDBC">Sharding-JDBC<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/SpringCloud/" title="SpringCloud">SpringCloud<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Tomcat/" title="Tomcat">Tomcat<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/auth/" title="auth">auth<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/docker/" title="docker">docker<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/hexo/" title="hexo">hexo<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/kubernates/" title="kubernates">kubernates<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/maven/" title="maven">maven<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/mybatis/" title="mybatis">mybatis<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/mysql/" title="mysql">mysql<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/nginx/" title="nginx">nginx<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/nginx-负载均衡/" title="nginx, 负载均衡">nginx, 负载均衡<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/spring-boot/" title="spring-boot">spring-boot<sup>25</sup></a></li>
		  
		
		  
			<li><a href="/categories/springboot/" title="springboot">springboot<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/web/" title="web">web<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/与你同行/" title="与你同行">与你同行<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/专题-分布式/" title="专题-分布式">专题-分布式<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/代理模式-工作总结-入职感受/" title="代理模式,工作总结,入职感受">代理模式,工作总结,入职感受<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/分布式-Dubbo/" title="分布式 Dubbo">分布式 Dubbo<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/单例模式/" title="单例模式">单例模式<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/年度总结/" title="年度总结">年度总结<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库/" title="数据库">数据库<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/架构/" title="架构">架构<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/汇总盘点推荐/" title="汇总盘点推荐">汇总盘点推荐<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/爬虫/" title="爬虫">爬虫<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/电话面试/" title="电话面试">电话面试<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/研磨Kafka/" title="研磨Kafka">研磨Kafka<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/自己写分布式组件系列/" title="自己写分布式组件系列">自己写分布式组件系列<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/跟我学RocketMQ/" title="跟我学RocketMQ">跟我学RocketMQ<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/随笔/" title="随笔">随笔<sup>5</sup></a></li>
		  
		
		</ul>
</div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/Dubbo/" style="font-size: 13.33px;">Dubbo</a> <a href="/tags/ELK-Stack/" style="font-size: 15.56px;">ELK-Stack</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/JDK-concurrent/" style="font-size: 12.22px;">JDK-concurrent</a> <a href="/tags/JDK源码解析/" style="font-size: 13.33px;">JDK源码解析</a> <a href="/tags/Java/" style="font-size: 18.89px;">Java</a> <a href="/tags/KindEditor/" style="font-size: 10px;">KindEditor</a> <a href="/tags/Linux/" style="font-size: 11.11px;">Linux</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SSO-单点登录/" style="font-size: 10px;">SSO,单点登录</a> <a href="/tags/Sharding-JDBC/" style="font-size: 13.33px;">Sharding-JDBC</a> <a href="/tags/SpringCloud/" style="font-size: 10px;">SpringCloud</a> <a href="/tags/Tomcat/" style="font-size: 11.11px;">Tomcat</a> <a href="/tags/auth/" style="font-size: 11.11px;">auth</a> <a href="/tags/docker/" style="font-size: 12.22px;">docker</a> <a href="/tags/hexo/" style="font-size: 11.11px;">hexo</a> <a href="/tags/kubernates/" style="font-size: 10px;">kubernates</a> <a href="/tags/maven/" style="font-size: 12.22px;">maven</a> <a href="/tags/mybatis/" style="font-size: 11.11px;">mybatis</a> <a href="/tags/mysql/" style="font-size: 14.44px;">mysql</a> <a href="/tags/nginx/" style="font-size: 11.11px;">nginx</a> <a href="/tags/spring-boot/" style="font-size: 20px;">spring-boot</a> <a href="/tags/springboot/" style="font-size: 10px;">springboot</a> <a href="/tags/web/" style="font-size: 13.33px;">web</a> <a href="/tags/与你同行/" style="font-size: 10px;">与你同行</a> <a href="/tags/专题-分布式/" style="font-size: 17.78px;">专题-分布式</a> <a href="/tags/代理模式-工作总结-入职感受/" style="font-size: 10px;">代理模式,工作总结,入职感受</a> <a href="/tags/分布式-Dubbo/" style="font-size: 13.33px;">分布式 Dubbo</a> <a href="/tags/单例模式-懒加载/" style="font-size: 10px;">单例模式, 懒加载</a> <a href="/tags/年度总结/" style="font-size: 12.22px;">年度总结</a> <a href="/tags/我们的爱情/" style="font-size: 10px;">我们的爱情</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a> <a href="/tags/汇总盘点推荐/" style="font-size: 10px;">汇总盘点推荐</a> <a href="/tags/爬虫-WebMagic/" style="font-size: 10px;">爬虫,WebMagic</a> <a href="/tags/电话面试/" style="font-size: 10px;">电话面试</a> <a href="/tags/研磨Kafka/" style="font-size: 14.44px;">研磨Kafka</a> <a href="/tags/秒杀/" style="font-size: 10px;">秒杀</a> <a href="/tags/自己写分布式组件系列/" style="font-size: 16.67px;">自己写分布式组件系列</a> <a href="/tags/跟我学RocketMQ/" style="font-size: 15.56px;">跟我学RocketMQ</a> <a href="/tags/随笔/" style="font-size: 14.44px;">随笔</a>
    </div>
  </div>


  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="TaXueWWL" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/spring-boot/" title="spring-boot">spring-boot<sup>25</sup></a></li>
			
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>23</sup></a></li>
			
		
			
				<li><a href="/tags/专题-分布式/" title="专题-分布式">专题-分布式<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/自己写分布式组件系列/" title="自己写分布式组件系列">自己写分布式组件系列<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/跟我学RocketMQ/" title="跟我学RocketMQ">跟我学RocketMQ<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/ELK-Stack/" title="ELK-Stack">ELK-Stack<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/随笔/" title="随笔">随笔<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/研磨Kafka/" title="研磨Kafka">研磨Kafka<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/mysql/" title="mysql">mysql<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Dubbo/" title="Dubbo">Dubbo<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/web/" title="web">web<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/分布式-Dubbo/" title="分布式 Dubbo">分布式 Dubbo<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Sharding-JDBC/" title="Sharding-JDBC">Sharding-JDBC<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/JDK源码解析/" title="JDK源码解析">JDK源码解析<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/年度总结/" title="年度总结">年度总结<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/maven/" title="maven">maven<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/JDK-concurrent/" title="JDK-concurrent">JDK-concurrent<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/auth/" title="auth">auth<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="undefined" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p>  <br/>
			惟精惟一，允执厥中 朝闻道，夕死可矣</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/TaXueWWL" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		<a href="http://www.zhihu.com/people/TaXueWWL" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:wuwenliangsn@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="SnoWalker">SnoWalker</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"snowalker"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>

<a href="https://github.com/TaXueWWL" target="_blank"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub"></a>